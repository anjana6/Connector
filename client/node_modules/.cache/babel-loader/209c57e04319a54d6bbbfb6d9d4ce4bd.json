{"ast":null,"code":"'use strict';\n/*!\n * Module dependencies.\n */\n\nvar Buffer = require('safe-buffer').Buffer;\n\nvar RegExpClone = require('regexp-clone');\n/**\n * Clones objects\n *\n * @param {Object} obj the object to clone\n * @param {Object} options\n * @return {Object} the cloned object\n * @api private\n */\n\n\nvar clone = exports.clone = function clone(obj, options) {\n  if (obj === undefined || obj === null) return obj;\n  if (Array.isArray(obj)) return exports.cloneArray(obj, options);\n\n  if (obj.constructor) {\n    if (/ObjectI[dD]$/.test(obj.constructor.name)) {\n      return 'function' == typeof obj.clone ? obj.clone() : new obj.constructor(obj.id);\n    }\n\n    if (obj.constructor.name === 'ReadPreference') {\n      return new obj.constructor(obj.mode, clone(obj.tags, options));\n    }\n\n    if ('Binary' == obj._bsontype && obj.buffer && obj.value) {\n      return 'function' == typeof obj.clone ? obj.clone() : new obj.constructor(obj.value(true), obj.sub_type);\n    }\n\n    if ('Date' === obj.constructor.name || 'Function' === obj.constructor.name) return new obj.constructor(+obj);\n    if ('RegExp' === obj.constructor.name) return RegExpClone(obj);\n    if ('Buffer' === obj.constructor.name) return exports.cloneBuffer(obj);\n  }\n\n  if (isObject(obj)) return exports.cloneObject(obj, options);\n  if (obj.valueOf) return obj.valueOf();\n};\n/*!\n * ignore\n */\n\n\nexports.cloneObject = function cloneObject(obj, options) {\n  var minimize = options && options.minimize;\n  var ret = {};\n  var hasKeys;\n  var val;\n  var k;\n\n  for (k in obj) {\n    val = clone(obj[k], options);\n\n    if (!minimize || 'undefined' !== typeof val) {\n      hasKeys || (hasKeys = true);\n      ret[k] = val;\n    }\n  }\n\n  return minimize ? hasKeys && ret : ret;\n};\n\nexports.cloneArray = function cloneArray(arr, options) {\n  var ret = [];\n\n  for (var i = 0, l = arr.length; i < l; i++) ret.push(clone(arr[i], options));\n\n  return ret;\n};\n/**\n * process.nextTick helper.\n *\n * Wraps the given `callback` in a try/catch. If an error is\n * caught it will be thrown on nextTick.\n *\n * node-mongodb-native had a habit of state corruption when\n * an error was immediately thrown from within a collection\n * method (find, update, etc) callback.\n *\n * @param {Function} [callback]\n * @api private\n */\n\n\nexports.tick = function tick(callback) {\n  if ('function' !== typeof callback) return;\n  return function () {\n    // callbacks should always be fired on the next\n    // turn of the event loop. A side benefit is\n    // errors thrown from executing the callback\n    // will not cause drivers state to be corrupted\n    // which has historically been a problem.\n    var args = arguments;\n    soon(function () {\n      callback.apply(this, args);\n    });\n  };\n};\n/**\n * Merges `from` into `to` without overwriting existing properties.\n *\n * @param {Object} to\n * @param {Object} from\n * @api private\n */\n\n\nexports.merge = function merge(to, from) {\n  var keys = Object.keys(from),\n      i = keys.length,\n      key;\n\n  while (i--) {\n    key = keys[i];\n\n    if ('undefined' === typeof to[key]) {\n      to[key] = from[key];\n    } else {\n      if (exports.isObject(from[key])) {\n        merge(to[key], from[key]);\n      } else {\n        to[key] = from[key];\n      }\n    }\n  }\n};\n/**\n * Same as merge but clones the assigned values.\n *\n * @param {Object} to\n * @param {Object} from\n * @api private\n */\n\n\nexports.mergeClone = function mergeClone(to, from) {\n  var keys = Object.keys(from),\n      i = keys.length,\n      key;\n\n  while (i--) {\n    key = keys[i];\n\n    if ('undefined' === typeof to[key]) {\n      to[key] = clone(from[key]);\n    } else {\n      if (exports.isObject(from[key])) {\n        mergeClone(to[key], from[key]);\n      } else {\n        to[key] = clone(from[key]);\n      }\n    }\n  }\n};\n/**\n * Read pref helper (mongo 2.2 drivers support this)\n *\n * Allows using aliases instead of full preference names:\n *\n *     p   primary\n *     pp  primaryPreferred\n *     s   secondary\n *     sp  secondaryPreferred\n *     n   nearest\n *\n * @param {String} pref\n */\n\n\nexports.readPref = function readPref(pref) {\n  switch (pref) {\n    case 'p':\n      pref = 'primary';\n      break;\n\n    case 'pp':\n      pref = 'primaryPreferred';\n      break;\n\n    case 's':\n      pref = 'secondary';\n      break;\n\n    case 'sp':\n      pref = 'secondaryPreferred';\n      break;\n\n    case 'n':\n      pref = 'nearest';\n      break;\n  }\n\n  return pref;\n};\n/**\n * Read Concern helper (mongo 3.2 drivers support this)\n *\n * Allows using string to specify read concern level:\n *\n *     local          3.2+\n *     available      3.6+\n *     majority       3.2+\n *     linearizable   3.4+\n *     snapshot       4.0+\n *\n * @param {String|Object} concern\n */\n\n\nexports.readConcern = function readConcern(concern) {\n  if ('string' === typeof concern) {\n    switch (concern) {\n      case 'l':\n        concern = 'local';\n        break;\n\n      case 'a':\n        concern = 'available';\n        break;\n\n      case 'm':\n        concern = 'majority';\n        break;\n\n      case 'lz':\n        concern = 'linearizable';\n        break;\n\n      case 's':\n        concern = 'snapshot';\n        break;\n    }\n\n    concern = {\n      level: concern\n    };\n  }\n\n  return concern;\n};\n/**\n * Object.prototype.toString.call helper\n */\n\n\nvar _toString = Object.prototype.toString;\n\nexports.toString = function (arg) {\n  return _toString.call(arg);\n};\n/**\n * Determines if `arg` is an object.\n *\n * @param {Object|Array|String|Function|RegExp|any} arg\n * @return {Boolean}\n */\n\n\nvar isObject = exports.isObject = function (arg) {\n  return '[object Object]' == exports.toString(arg);\n};\n/**\n * Determines if `arg` is an array.\n *\n * @param {Object}\n * @return {Boolean}\n * @see nodejs utils\n */\n\n\nexports.isArray = function (arg) {\n  return Array.isArray(arg) || 'object' == typeof arg && '[object Array]' == exports.toString(arg);\n};\n/**\n * Object.keys helper\n */\n\n\nexports.keys = Object.keys || function (obj) {\n  var keys = [];\n\n  for (var k in obj) if (obj.hasOwnProperty(k)) {\n    keys.push(k);\n  }\n\n  return keys;\n};\n/**\n * Basic Object.create polyfill.\n * Only one argument is supported.\n *\n * Based on https://developer.mozilla.org/en-US/docs/JavaScript/Reference/Global_Objects/Object/create\n */\n\n\nexports.create = 'function' == typeof Object.create ? Object.create : create;\n\nfunction create(proto) {\n  if (arguments.length > 1) {\n    throw new Error('Adding properties is not supported');\n  }\n\n  function F() {}\n\n  F.prototype = proto;\n  return new F();\n}\n/**\n * inheritance\n */\n\n\nexports.inherits = function (ctor, superCtor) {\n  ctor.prototype = exports.create(superCtor.prototype);\n  ctor.prototype.constructor = ctor;\n};\n/**\n * nextTick helper\n * compat with node 0.10 which behaves differently than previous versions\n */\n\n\nvar soon = exports.soon = 'function' == typeof setImmediate ? setImmediate : process.nextTick;\n/**\n * Clones the contents of a buffer.\n *\n * @param {Buffer} buff\n * @return {Buffer}\n */\n\nexports.cloneBuffer = function (buff) {\n  var dupe = Buffer.alloc(buff.length);\n  buff.copy(dupe, 0, 0, buff.length);\n  return dupe;\n};\n/**\n * Check if this object is an arguments object\n *\n * @param {Any} v\n * @return {Boolean}\n */\n\n\nexports.isArgumentsObject = function (v) {\n  return Object.prototype.toString.call(v) === '[object Arguments]';\n};","map":{"version":3,"sources":["D:/Other/Git/Developer-Connector/node_modules/mquery/lib/utils.js"],"names":["Buffer","require","RegExpClone","clone","exports","obj","options","undefined","Array","isArray","cloneArray","constructor","test","name","id","mode","tags","_bsontype","buffer","value","sub_type","cloneBuffer","isObject","cloneObject","valueOf","minimize","ret","hasKeys","val","k","arr","i","l","length","push","tick","callback","args","arguments","soon","apply","merge","to","from","keys","Object","key","mergeClone","readPref","pref","readConcern","concern","level","_toString","prototype","toString","arg","call","hasOwnProperty","create","proto","Error","F","inherits","ctor","superCtor","setImmediate","process","nextTick","buff","dupe","alloc","copy","isArgumentsObject","v"],"mappings":"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","sourcesContent":["'use strict';\n\n/*!\n * Module dependencies.\n */\n\nvar Buffer = require('safe-buffer').Buffer;\nvar RegExpClone = require('regexp-clone');\n\n/**\n * Clones objects\n *\n * @param {Object} obj the object to clone\n * @param {Object} options\n * @return {Object} the cloned object\n * @api private\n */\n\nvar clone = exports.clone = function clone(obj, options) {\n  if (obj === undefined || obj === null)\n    return obj;\n\n  if (Array.isArray(obj))\n    return exports.cloneArray(obj, options);\n\n  if (obj.constructor) {\n    if (/ObjectI[dD]$/.test(obj.constructor.name)) {\n      return 'function' == typeof obj.clone\n        ? obj.clone()\n        : new obj.constructor(obj.id);\n    }\n\n    if (obj.constructor.name === 'ReadPreference') {\n      return new obj.constructor(obj.mode, clone(obj.tags, options));\n    }\n\n    if ('Binary' == obj._bsontype && obj.buffer && obj.value) {\n      return 'function' == typeof obj.clone\n        ? obj.clone()\n        : new obj.constructor(obj.value(true), obj.sub_type);\n    }\n\n    if ('Date' === obj.constructor.name || 'Function' === obj.constructor.name)\n      return new obj.constructor(+obj);\n\n    if ('RegExp' === obj.constructor.name)\n      return RegExpClone(obj);\n\n    if ('Buffer' === obj.constructor.name)\n      return exports.cloneBuffer(obj);\n  }\n\n  if (isObject(obj))\n    return exports.cloneObject(obj, options);\n\n  if (obj.valueOf)\n    return obj.valueOf();\n};\n\n/*!\n * ignore\n */\n\nexports.cloneObject = function cloneObject(obj, options) {\n  var minimize = options && options.minimize;\n  var ret = {};\n  var hasKeys;\n  var val;\n  var k;\n\n  for (k in obj) {\n    val = clone(obj[k], options);\n\n    if (!minimize || ('undefined' !== typeof val)) {\n      hasKeys || (hasKeys = true);\n      ret[k] = val;\n    }\n  }\n\n  return minimize\n    ? hasKeys && ret\n    : ret;\n};\n\nexports.cloneArray = function cloneArray(arr, options) {\n  var ret = [];\n  for (var i = 0, l = arr.length; i < l; i++)\n    ret.push(clone(arr[i], options));\n  return ret;\n};\n\n/**\n * process.nextTick helper.\n *\n * Wraps the given `callback` in a try/catch. If an error is\n * caught it will be thrown on nextTick.\n *\n * node-mongodb-native had a habit of state corruption when\n * an error was immediately thrown from within a collection\n * method (find, update, etc) callback.\n *\n * @param {Function} [callback]\n * @api private\n */\n\nexports.tick = function tick(callback) {\n  if ('function' !== typeof callback) return;\n  return function() {\n    // callbacks should always be fired on the next\n    // turn of the event loop. A side benefit is\n    // errors thrown from executing the callback\n    // will not cause drivers state to be corrupted\n    // which has historically been a problem.\n    var args = arguments;\n    soon(function() {\n      callback.apply(this, args);\n    });\n  };\n};\n\n/**\n * Merges `from` into `to` without overwriting existing properties.\n *\n * @param {Object} to\n * @param {Object} from\n * @api private\n */\n\nexports.merge = function merge(to, from) {\n  var keys = Object.keys(from),\n      i = keys.length,\n      key;\n\n  while (i--) {\n    key = keys[i];\n    if ('undefined' === typeof to[key]) {\n      to[key] = from[key];\n    } else {\n      if (exports.isObject(from[key])) {\n        merge(to[key], from[key]);\n      } else {\n        to[key] = from[key];\n      }\n    }\n  }\n};\n\n/**\n * Same as merge but clones the assigned values.\n *\n * @param {Object} to\n * @param {Object} from\n * @api private\n */\n\nexports.mergeClone = function mergeClone(to, from) {\n  var keys = Object.keys(from),\n      i = keys.length,\n      key;\n\n  while (i--) {\n    key = keys[i];\n    if ('undefined' === typeof to[key]) {\n      to[key] = clone(from[key]);\n    } else {\n      if (exports.isObject(from[key])) {\n        mergeClone(to[key], from[key]);\n      } else {\n        to[key] = clone(from[key]);\n      }\n    }\n  }\n};\n\n/**\n * Read pref helper (mongo 2.2 drivers support this)\n *\n * Allows using aliases instead of full preference names:\n *\n *     p   primary\n *     pp  primaryPreferred\n *     s   secondary\n *     sp  secondaryPreferred\n *     n   nearest\n *\n * @param {String} pref\n */\n\nexports.readPref = function readPref(pref) {\n  switch (pref) {\n    case 'p':\n      pref = 'primary';\n      break;\n    case 'pp':\n      pref = 'primaryPreferred';\n      break;\n    case 's':\n      pref = 'secondary';\n      break;\n    case 'sp':\n      pref = 'secondaryPreferred';\n      break;\n    case 'n':\n      pref = 'nearest';\n      break;\n  }\n\n  return pref;\n};\n\n\n/**\n * Read Concern helper (mongo 3.2 drivers support this)\n *\n * Allows using string to specify read concern level:\n *\n *     local          3.2+\n *     available      3.6+\n *     majority       3.2+\n *     linearizable   3.4+\n *     snapshot       4.0+\n *\n * @param {String|Object} concern\n */\n\nexports.readConcern = function readConcern(concern) {\n  if ('string' === typeof concern) {\n    switch (concern) {\n      case 'l':\n        concern = 'local';\n        break;\n      case 'a':\n        concern = 'available';\n        break;\n      case 'm':\n        concern = 'majority';\n        break;\n      case 'lz':\n        concern = 'linearizable';\n        break;\n      case 's':\n        concern = 'snapshot';\n        break;\n    }\n    concern = { level: concern };\n  }\n  return concern;\n};\n\n/**\n * Object.prototype.toString.call helper\n */\n\nvar _toString = Object.prototype.toString;\nexports.toString = function(arg) {\n  return _toString.call(arg);\n};\n\n/**\n * Determines if `arg` is an object.\n *\n * @param {Object|Array|String|Function|RegExp|any} arg\n * @return {Boolean}\n */\n\nvar isObject = exports.isObject = function(arg) {\n  return '[object Object]' == exports.toString(arg);\n};\n\n/**\n * Determines if `arg` is an array.\n *\n * @param {Object}\n * @return {Boolean}\n * @see nodejs utils\n */\n\nexports.isArray = function(arg) {\n  return Array.isArray(arg) ||\n    'object' == typeof arg && '[object Array]' == exports.toString(arg);\n};\n\n/**\n * Object.keys helper\n */\n\nexports.keys = Object.keys || function(obj) {\n  var keys = [];\n  for (var k in obj) if (obj.hasOwnProperty(k)) {\n    keys.push(k);\n  }\n  return keys;\n};\n\n/**\n * Basic Object.create polyfill.\n * Only one argument is supported.\n *\n * Based on https://developer.mozilla.org/en-US/docs/JavaScript/Reference/Global_Objects/Object/create\n */\n\nexports.create = 'function' == typeof Object.create\n  ? Object.create\n  : create;\n\nfunction create(proto) {\n  if (arguments.length > 1) {\n    throw new Error('Adding properties is not supported');\n  }\n\n  function F() {}\n  F.prototype = proto;\n  return new F;\n}\n\n/**\n * inheritance\n */\n\nexports.inherits = function(ctor, superCtor) {\n  ctor.prototype = exports.create(superCtor.prototype);\n  ctor.prototype.constructor = ctor;\n};\n\n/**\n * nextTick helper\n * compat with node 0.10 which behaves differently than previous versions\n */\n\nvar soon = exports.soon = 'function' == typeof setImmediate\n  ? setImmediate\n  : process.nextTick;\n\n/**\n * Clones the contents of a buffer.\n *\n * @param {Buffer} buff\n * @return {Buffer}\n */\n\nexports.cloneBuffer = function(buff) {\n  var dupe = Buffer.alloc(buff.length);\n  buff.copy(dupe, 0, 0, buff.length);\n  return dupe;\n};\n\n/**\n * Check if this object is an arguments object\n *\n * @param {Any} v\n * @return {Boolean}\n */\n\nexports.isArgumentsObject = function(v) {\n  return Object.prototype.toString.call(v) === '[object Arguments]';\n};\n"]},"metadata":{},"sourceType":"script"}