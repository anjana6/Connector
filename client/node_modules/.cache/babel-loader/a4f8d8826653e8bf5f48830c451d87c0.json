{"ast":null,"code":"'use strict';\n/*!\n * Module dependencies.\n */\n\nconst Decimal = require('./types/decimal128');\n\nconst ObjectId = require('./types/objectid');\n\nconst PopulateOptions = require('./options/PopulateOptions');\n\nconst PromiseProvider = require('./promise_provider');\n\nconst cloneRegExp = require('regexp-clone');\n\nconst get = require('./helpers/get');\n\nconst sliced = require('sliced');\n\nconst mpath = require('mpath');\n\nconst ms = require('ms');\n\nconst symbols = require('./helpers/symbols');\n\nconst Buffer = require('safe-buffer').Buffer;\n\nconst emittedSymbol = Symbol.for('mongoose:emitted');\nlet MongooseBuffer;\nlet MongooseArray;\nlet Document;\nconst specialProperties = new Set(['__proto__', 'constructor', 'prototype']);\nexports.specialProperties = specialProperties;\n/*!\n * Produces a collection name from model `name`. By default, just returns\n * the model name\n *\n * @param {String} name a model name\n * @param {Function} pluralize function that pluralizes the collection name\n * @return {String} a collection name\n * @api private\n */\n\nexports.toCollectionName = function (name, pluralize) {\n  if (name === 'system.profile') {\n    return name;\n  }\n\n  if (name === 'system.indexes') {\n    return name;\n  }\n\n  if (typeof pluralize === 'function') {\n    return pluralize(name);\n  }\n\n  return name;\n};\n/*!\n * Determines if `a` and `b` are deep equal.\n *\n * Modified from node/lib/assert.js\n *\n * @param {any} a a value to compare to `b`\n * @param {any} b a value to compare to `a`\n * @return {Boolean}\n * @api private\n */\n\n\nexports.deepEqual = function deepEqual(a, b) {\n  if (a === b) {\n    return true;\n  }\n\n  if (a instanceof Date && b instanceof Date) {\n    return a.getTime() === b.getTime();\n  }\n\n  if (isBsonType(a, 'ObjectID') && isBsonType(b, 'ObjectID') || isBsonType(a, 'Decimal128') && isBsonType(b, 'Decimal128')) {\n    return a.toString() === b.toString();\n  }\n\n  if (a instanceof RegExp && b instanceof RegExp) {\n    return a.source === b.source && a.ignoreCase === b.ignoreCase && a.multiline === b.multiline && a.global === b.global;\n  }\n\n  if (typeof a !== 'object' && typeof b !== 'object') {\n    return a == b;\n  }\n\n  if (a === null || b === null || a === undefined || b === undefined) {\n    return false;\n  }\n\n  if (a.prototype !== b.prototype) {\n    return false;\n  } // Handle MongooseNumbers\n\n\n  if (a instanceof Number && b instanceof Number) {\n    return a.valueOf() === b.valueOf();\n  }\n\n  if (Buffer.isBuffer(a)) {\n    return exports.buffer.areEqual(a, b);\n  }\n\n  if (isMongooseObject(a)) {\n    a = a.toObject();\n  }\n\n  if (isMongooseObject(b)) {\n    b = b.toObject();\n  }\n\n  let ka;\n  let kb;\n  let key;\n  let i;\n\n  try {\n    ka = Object.keys(a);\n    kb = Object.keys(b);\n  } catch (e) {\n    // happens when one is a string literal and the other isn't\n    return false;\n  } // having the same number of owned properties (keys incorporates\n  // hasOwnProperty)\n\n\n  if (ka.length !== kb.length) {\n    return false;\n  } // the same set of keys (although not necessarily the same order),\n\n\n  ka.sort();\n  kb.sort(); // ~~~cheap key test\n\n  for (i = ka.length - 1; i >= 0; i--) {\n    if (ka[i] !== kb[i]) {\n      return false;\n    }\n  } // equivalent values for every corresponding key, and\n  // ~~~possibly expensive deep test\n\n\n  for (i = ka.length - 1; i >= 0; i--) {\n    key = ka[i];\n\n    if (!deepEqual(a[key], b[key])) {\n      return false;\n    }\n  }\n\n  return true;\n};\n/*!\n * Get the bson type, if it exists\n */\n\n\nfunction isBsonType(obj, typename) {\n  return get(obj, '_bsontype', void 0) === typename;\n}\n/*!\n * Get the last element of an array\n */\n\n\nexports.last = function (arr) {\n  if (arr.length > 0) {\n    return arr[arr.length - 1];\n  }\n\n  return void 0;\n};\n/*!\n * Object clone with Mongoose natives support.\n *\n * If options.minimize is true, creates a minimal data object. Empty objects and undefined values will not be cloned. This makes the data payload sent to MongoDB as small as possible.\n *\n * Functions are never cloned.\n *\n * @param {Object} obj the object to clone\n * @param {Object} options\n * @param {Boolean} isArrayChild true if cloning immediately underneath an array. Special case for minimize.\n * @return {Object} the cloned object\n * @api private\n */\n\n\nexports.clone = function clone(obj, options, isArrayChild) {\n  if (obj == null) {\n    return obj;\n  }\n\n  if (Array.isArray(obj)) {\n    return cloneArray(obj, options);\n  }\n\n  if (isMongooseObject(obj)) {\n    // Single nested subdocs should apply getters later in `applyGetters()`\n    // when calling `toObject()`. See gh-7442, gh-8295\n    if (options && options._skipSingleNestedGetters && obj.$isSingleNested) {\n      options = Object.assign({}, options, {\n        getters: false\n      });\n    }\n\n    if (options && options.json && typeof obj.toJSON === 'function') {\n      return obj.toJSON(options);\n    }\n\n    return obj.toObject(options);\n  }\n\n  if (obj.constructor) {\n    switch (exports.getFunctionName(obj.constructor)) {\n      case 'Object':\n        return cloneObject(obj, options, isArrayChild);\n\n      case 'Date':\n        return new obj.constructor(+obj);\n\n      case 'RegExp':\n        return cloneRegExp(obj);\n\n      default:\n        // ignore\n        break;\n    }\n  }\n\n  if (obj instanceof ObjectId) {\n    return new ObjectId(obj.id);\n  }\n\n  if (isBsonType(obj, 'Decimal128')) {\n    if (options && options.flattenDecimals) {\n      return obj.toJSON();\n    }\n\n    return Decimal.fromString(obj.toString());\n  }\n\n  if (!obj.constructor && exports.isObject(obj)) {\n    // object created with Object.create(null)\n    return cloneObject(obj, options, isArrayChild);\n  }\n\n  if (obj[symbols.schemaTypeSymbol]) {\n    return obj.clone();\n  } // If we're cloning this object to go into a MongoDB command,\n  // and there's a `toBSON()` function, assume this object will be\n  // stored as a primitive in MongoDB and doesn't need to be cloned.\n\n\n  if (options && options.bson && typeof obj.toBSON === 'function') {\n    return obj;\n  }\n\n  if (obj.valueOf != null) {\n    return obj.valueOf();\n  }\n\n  return cloneObject(obj, options, isArrayChild);\n};\n\nconst clone = exports.clone;\n/*!\n * ignore\n */\n\nexports.promiseOrCallback = function promiseOrCallback(callback, fn, ee) {\n  if (typeof callback === 'function') {\n    return fn(function (error) {\n      if (error != null) {\n        if (ee != null && ee.listeners('error').length > 0 && !error[emittedSymbol]) {\n          error[emittedSymbol] = true;\n          ee.emit('error', error);\n        }\n\n        try {\n          callback(error);\n        } catch (error) {\n          return process.nextTick(() => {\n            throw error;\n          });\n        }\n\n        return;\n      }\n\n      callback.apply(this, arguments);\n    });\n  }\n\n  const Promise = PromiseProvider.get();\n  return new Promise((resolve, reject) => {\n    fn(function (error, res) {\n      if (error != null) {\n        if (ee != null && ee.listeners('error').length > 0 && !error[emittedSymbol]) {\n          error[emittedSymbol] = true;\n          ee.emit('error', error);\n        }\n\n        return reject(error);\n      }\n\n      if (arguments.length > 2) {\n        return resolve(Array.prototype.slice.call(arguments, 1));\n      }\n\n      resolve(res);\n    });\n  });\n};\n/*!\n * ignore\n */\n\n\nexports.omit = function omit(obj, keys) {\n  if (keys == null) {\n    return Object.assign({}, obj);\n  }\n\n  if (!Array.isArray(keys)) {\n    keys = [keys];\n  }\n\n  const ret = Object.assign({}, obj);\n\n  for (const key of keys) {\n    delete ret[key];\n  }\n\n  return ret;\n};\n/*!\n * ignore\n */\n\n\nfunction cloneObject(obj, options, isArrayChild) {\n  const minimize = options && options.minimize;\n  const ret = {};\n  let hasKeys;\n\n  for (const k in obj) {\n    if (specialProperties.has(k)) {\n      continue;\n    } // Don't pass `isArrayChild` down\n\n\n    const val = clone(obj[k], options);\n\n    if (!minimize || typeof val !== 'undefined') {\n      hasKeys || (hasKeys = true);\n      ret[k] = val;\n    }\n  }\n\n  return minimize && !isArrayChild ? hasKeys && ret : ret;\n}\n\nfunction cloneArray(arr, options) {\n  const ret = [];\n\n  for (let i = 0, l = arr.length; i < l; i++) {\n    ret.push(clone(arr[i], options, true));\n  }\n\n  return ret;\n}\n/*!\n * Shallow copies defaults into options.\n *\n * @param {Object} defaults\n * @param {Object} options\n * @return {Object} the merged object\n * @api private\n */\n\n\nexports.options = function (defaults, options) {\n  const keys = Object.keys(defaults);\n  let i = keys.length;\n  let k;\n  options = options || {};\n\n  while (i--) {\n    k = keys[i];\n\n    if (!(k in options)) {\n      options[k] = defaults[k];\n    }\n  }\n\n  return options;\n};\n/*!\n * Generates a random string\n *\n * @api private\n */\n\n\nexports.random = function () {\n  return Math.random().toString().substr(3);\n};\n/*!\n * Merges `from` into `to` without overwriting existing properties.\n *\n * @param {Object} to\n * @param {Object} from\n * @api private\n */\n\n\nexports.merge = function merge(to, from, options, path) {\n  options = options || {};\n  const keys = Object.keys(from);\n  let i = 0;\n  const len = keys.length;\n  let key;\n  path = path || '';\n  const omitNested = options.omitNested || {};\n\n  while (i < len) {\n    key = keys[i++];\n\n    if (options.omit && options.omit[key]) {\n      continue;\n    }\n\n    if (omitNested[path]) {\n      continue;\n    }\n\n    if (specialProperties.has(key)) {\n      continue;\n    }\n\n    if (to[key] == null) {\n      to[key] = from[key];\n    } else if (exports.isObject(from[key])) {\n      if (!exports.isObject(to[key])) {\n        to[key] = {};\n      }\n\n      if (from[key] != null) {\n        if (from[key].instanceOfSchema) {\n          if (to[key].instanceOfSchema) {\n            to[key].add(from[key].clone());\n          } else {\n            to[key] = from[key].clone();\n          }\n\n          continue;\n        } else if (from[key] instanceof ObjectId) {\n          to[key] = new ObjectId(from[key]);\n          continue;\n        }\n      }\n\n      merge(to[key], from[key], options, path ? path + '.' + key : key);\n    } else if (options.overwrite) {\n      to[key] = from[key];\n    }\n  }\n};\n/*!\n * Applies toObject recursively.\n *\n * @param {Document|Array|Object} obj\n * @return {Object}\n * @api private\n */\n\n\nexports.toObject = function toObject(obj) {\n  Document || (Document = require('./document'));\n  let ret;\n\n  if (obj == null) {\n    return obj;\n  }\n\n  if (obj instanceof Document) {\n    return obj.toObject();\n  }\n\n  if (Array.isArray(obj)) {\n    ret = [];\n\n    for (let i = 0, len = obj.length; i < len; ++i) {\n      ret.push(toObject(obj[i]));\n    }\n\n    return ret;\n  }\n\n  if (exports.isPOJO(obj)) {\n    ret = {};\n\n    for (const k in obj) {\n      if (specialProperties.has(k)) {\n        continue;\n      }\n\n      ret[k] = toObject(obj[k]);\n    }\n\n    return ret;\n  }\n\n  return obj;\n};\n/*!\n * Determines if `arg` is an object.\n *\n * @param {Object|Array|String|Function|RegExp|any} arg\n * @api private\n * @return {Boolean}\n */\n\n\nexports.isObject = function (arg) {\n  if (Buffer.isBuffer(arg)) {\n    return true;\n  }\n\n  return Object.prototype.toString.call(arg) === '[object Object]';\n};\n/*!\n * Determines if `arg` is a plain old JavaScript object (POJO). Specifically,\n * `arg` must be an object but not an instance of any special class, like String,\n * ObjectId, etc.\n *\n * `Object.getPrototypeOf()` is part of ES5: https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/getPrototypeOf\n *\n * @param {Object|Array|String|Function|RegExp|any} arg\n * @api private\n * @return {Boolean}\n */\n\n\nexports.isPOJO = function isPOJO(arg) {\n  if (arg == null || typeof arg !== 'object') {\n    return false;\n  }\n\n  const proto = Object.getPrototypeOf(arg); // Prototype may be null if you used `Object.create(null)`\n  // Checking `proto`'s constructor is safe because `getPrototypeOf()`\n  // explicitly crosses the boundary from object data to object metadata\n\n  return !proto || proto.constructor.name === 'Object';\n};\n/*!\n * Determines if `obj` is a built-in object like an array, date, boolean,\n * etc.\n */\n\n\nexports.isNativeObject = function (arg) {\n  return Array.isArray(arg) || arg instanceof Date || arg instanceof Boolean || arg instanceof Number || arg instanceof String;\n};\n/*!\n * Determines if `val` is an object that has no own keys\n */\n\n\nexports.isEmptyObject = function (val) {\n  return val != null && typeof val === 'object' && Object.keys(val).length === 0;\n};\n/*!\n * Search if `obj` or any POJOs nested underneath `obj` has a property named\n * `key`\n */\n\n\nexports.hasKey = function hasKey(obj, key) {\n  const props = Object.keys(obj);\n\n  for (const prop of props) {\n    if (prop === key) {\n      return true;\n    }\n\n    if (exports.isPOJO(obj[prop]) && exports.hasKey(obj[prop], key)) {\n      return true;\n    }\n  }\n\n  return false;\n};\n/*!\n * A faster Array.prototype.slice.call(arguments) alternative\n * @api private\n */\n\n\nexports.args = sliced;\n/*!\n * process.nextTick helper.\n *\n * Wraps `callback` in a try/catch + nextTick.\n *\n * node-mongodb-native has a habit of state corruption when an error is immediately thrown from within a collection callback.\n *\n * @param {Function} callback\n * @api private\n */\n\nexports.tick = function tick(callback) {\n  if (typeof callback !== 'function') {\n    return;\n  }\n\n  return function () {\n    try {\n      callback.apply(this, arguments);\n    } catch (err) {\n      // only nextTick on err to get out of\n      // the event loop and avoid state corruption.\n      process.nextTick(function () {\n        throw err;\n      });\n    }\n  };\n};\n/*!\n * Returns true if `v` is an object that can be serialized as a primitive in\n * MongoDB\n */\n\n\nexports.isMongooseType = function (v) {\n  return v instanceof ObjectId || v instanceof Decimal || v instanceof Buffer;\n};\n/*!\n * Returns if `v` is a mongoose object that has a `toObject()` method we can use.\n *\n * This is for compatibility with libs like Date.js which do foolish things to Natives.\n *\n * @param {any} v\n * @api private\n */\n\n\nexports.isMongooseObject = function (v) {\n  Document || (Document = require('./document'));\n  MongooseArray || (MongooseArray = require('./types').Array);\n  MongooseBuffer || (MongooseBuffer = require('./types').Buffer);\n\n  if (v == null) {\n    return false;\n  }\n\n  return v.$__ != null || // Document\n  v.isMongooseArray || // Array or Document Array\n  v.isMongooseBuffer || // Buffer\n  v.$isMongooseMap; // Map\n};\n\nconst isMongooseObject = exports.isMongooseObject;\n/*!\n * Converts `expires` options of index objects to `expiresAfterSeconds` options for MongoDB.\n *\n * @param {Object} object\n * @api private\n */\n\nexports.expires = function expires(object) {\n  if (!(object && object.constructor.name === 'Object')) {\n    return;\n  }\n\n  if (!('expires' in object)) {\n    return;\n  }\n\n  let when;\n\n  if (typeof object.expires !== 'string') {\n    when = object.expires;\n  } else {\n    when = Math.round(ms(object.expires) / 1000);\n  }\n\n  object.expireAfterSeconds = when;\n  delete object.expires;\n};\n/*!\n * populate helper\n */\n\n\nexports.populate = function populate(path, select, model, match, options, subPopulate, justOne, count) {\n  // might have passed an object specifying all arguments\n  let obj = null;\n\n  if (arguments.length === 1) {\n    if (path instanceof PopulateOptions) {\n      return [path];\n    }\n\n    if (Array.isArray(path)) {\n      const singles = makeSingles(path);\n      return singles.map(o => exports.populate(o)[0]);\n    }\n\n    if (exports.isObject(path)) {\n      obj = Object.assign({}, path);\n    } else {\n      obj = {\n        path: path\n      };\n    }\n  } else if (typeof model === 'object') {\n    obj = {\n      path: path,\n      select: select,\n      match: model,\n      options: match\n    };\n  } else {\n    obj = {\n      path: path,\n      select: select,\n      model: model,\n      match: match,\n      options: options,\n      populate: subPopulate,\n      justOne: justOne,\n      count: count\n    };\n  }\n\n  if (typeof obj.path !== 'string') {\n    throw new TypeError('utils.populate: invalid path. Expected string. Got typeof `' + typeof path + '`');\n  }\n\n  return _populateObj(obj); // The order of select/conditions args is opposite Model.find but\n  // necessary to keep backward compatibility (select could be\n  // an array, string, or object literal).\n\n  function makeSingles(arr) {\n    const ret = [];\n    arr.forEach(function (obj) {\n      if (/[\\s]/.test(obj.path)) {\n        const paths = obj.path.split(' ');\n        paths.forEach(function (p) {\n          const copy = Object.assign({}, obj);\n          copy.path = p;\n          ret.push(copy);\n        });\n      } else {\n        ret.push(obj);\n      }\n    });\n    return ret;\n  }\n};\n\nfunction _populateObj(obj) {\n  if (Array.isArray(obj.populate)) {\n    const ret = [];\n    obj.populate.forEach(function (obj) {\n      if (/[\\s]/.test(obj.path)) {\n        const copy = Object.assign({}, obj);\n        const paths = copy.path.split(' ');\n        paths.forEach(function (p) {\n          copy.path = p;\n          ret.push(exports.populate(copy)[0]);\n        });\n      } else {\n        ret.push(exports.populate(obj)[0]);\n      }\n    });\n    obj.populate = exports.populate(ret);\n  } else if (obj.populate != null && typeof obj.populate === 'object') {\n    obj.populate = exports.populate(obj.populate);\n  }\n\n  const ret = [];\n  const paths = obj.path.split(' ');\n\n  if (obj.options != null) {\n    obj.options = exports.clone(obj.options);\n  }\n\n  for (let i = 0; i < paths.length; ++i) {\n    ret.push(new PopulateOptions(Object.assign({}, obj, {\n      path: paths[i]\n    })));\n  }\n\n  return ret;\n}\n/*!\n * Return the value of `obj` at the given `path`.\n *\n * @param {String} path\n * @param {Object} obj\n */\n\n\nexports.getValue = function (path, obj, map) {\n  return mpath.get(path, obj, '_doc', map);\n};\n/*!\n * Sets the value of `obj` at the given `path`.\n *\n * @param {String} path\n * @param {Anything} val\n * @param {Object} obj\n */\n\n\nexports.setValue = function (path, val, obj, map, _copying) {\n  mpath.set(path, val, obj, '_doc', map, _copying);\n};\n/*!\n * Returns an array of values from object `o`.\n *\n * @param {Object} o\n * @return {Array}\n * @private\n */\n\n\nexports.object = {};\n\nexports.object.vals = function vals(o) {\n  const keys = Object.keys(o);\n  let i = keys.length;\n  const ret = [];\n\n  while (i--) {\n    ret.push(o[keys[i]]);\n  }\n\n  return ret;\n};\n/*!\n * @see exports.options\n */\n\n\nexports.object.shallowCopy = exports.options;\n/*!\n * Safer helper for hasOwnProperty checks\n *\n * @param {Object} obj\n * @param {String} prop\n */\n\nconst hop = Object.prototype.hasOwnProperty;\n\nexports.object.hasOwnProperty = function (obj, prop) {\n  return hop.call(obj, prop);\n};\n/*!\n * Determine if `val` is null or undefined\n *\n * @return {Boolean}\n */\n\n\nexports.isNullOrUndefined = function (val) {\n  return val === null || val === undefined;\n};\n/*!\n * ignore\n */\n\n\nexports.array = {};\n/*!\n * Flattens an array.\n *\n * [ 1, [ 2, 3, [4] ]] -> [1,2,3,4]\n *\n * @param {Array} arr\n * @param {Function} [filter] If passed, will be invoked with each item in the array. If `filter` returns a falsy value, the item will not be included in the results.\n * @return {Array}\n * @private\n */\n\nexports.array.flatten = function flatten(arr, filter, ret) {\n  ret || (ret = []);\n  arr.forEach(function (item) {\n    if (Array.isArray(item)) {\n      flatten(item, filter, ret);\n    } else {\n      if (!filter || filter(item)) {\n        ret.push(item);\n      }\n    }\n  });\n  return ret;\n};\n/*!\n * ignore\n */\n\n\nconst _hasOwnProperty = Object.prototype.hasOwnProperty;\n\nexports.hasUserDefinedProperty = function (obj, key) {\n  if (obj == null) {\n    return false;\n  }\n\n  if (Array.isArray(key)) {\n    for (const k of key) {\n      if (exports.hasUserDefinedProperty(obj, k)) {\n        return true;\n      }\n    }\n\n    return false;\n  }\n\n  if (_hasOwnProperty.call(obj, key)) {\n    return true;\n  }\n\n  if (key in obj) {\n    const v = obj[key];\n    return v !== Object.prototype[key] && v !== Array.prototype[key];\n  }\n\n  return false;\n};\n/*!\n * ignore\n */\n\n\nconst MAX_ARRAY_INDEX = Math.pow(2, 32) - 1;\n\nexports.isArrayIndex = function (val) {\n  if (typeof val === 'number') {\n    return val >= 0 && val <= MAX_ARRAY_INDEX;\n  }\n\n  if (typeof val === 'string') {\n    if (!/^\\d+$/.test(val)) {\n      return false;\n    }\n\n    val = +val;\n    return val >= 0 && val <= MAX_ARRAY_INDEX;\n  }\n\n  return false;\n};\n/*!\n * Removes duplicate values from an array\n *\n * [1, 2, 3, 3, 5] => [1, 2, 3, 5]\n * [ ObjectId(\"550988ba0c19d57f697dc45e\"), ObjectId(\"550988ba0c19d57f697dc45e\") ]\n *    => [ObjectId(\"550988ba0c19d57f697dc45e\")]\n *\n * @param {Array} arr\n * @return {Array}\n * @private\n */\n\n\nexports.array.unique = function (arr) {\n  const primitives = {};\n  const ids = {};\n  const ret = [];\n  const length = arr.length;\n\n  for (let i = 0; i < length; ++i) {\n    if (typeof arr[i] === 'number' || typeof arr[i] === 'string' || arr[i] == null) {\n      if (primitives[arr[i]]) {\n        continue;\n      }\n\n      ret.push(arr[i]);\n      primitives[arr[i]] = true;\n    } else if (arr[i] instanceof ObjectId) {\n      if (ids[arr[i].toString()]) {\n        continue;\n      }\n\n      ret.push(arr[i]);\n      ids[arr[i].toString()] = true;\n    } else {\n      ret.push(arr[i]);\n    }\n  }\n\n  return ret;\n};\n/*!\n * Determines if two buffers are equal.\n *\n * @param {Buffer} a\n * @param {Object} b\n */\n\n\nexports.buffer = {};\n\nexports.buffer.areEqual = function (a, b) {\n  if (!Buffer.isBuffer(a)) {\n    return false;\n  }\n\n  if (!Buffer.isBuffer(b)) {\n    return false;\n  }\n\n  if (a.length !== b.length) {\n    return false;\n  }\n\n  for (let i = 0, len = a.length; i < len; ++i) {\n    if (a[i] !== b[i]) {\n      return false;\n    }\n  }\n\n  return true;\n};\n\nexports.getFunctionName = function (fn) {\n  if (fn.name) {\n    return fn.name;\n  }\n\n  return (fn.toString().trim().match(/^function\\s*([^\\s(]+)/) || [])[1];\n};\n/*!\n * Decorate buffers\n */\n\n\nexports.decorate = function (destination, source) {\n  for (const key in source) {\n    if (specialProperties.has(key)) {\n      continue;\n    }\n\n    destination[key] = source[key];\n  }\n};\n/**\n * merges to with a copy of from\n *\n * @param {Object} to\n * @param {Object} fromObj\n * @api private\n */\n\n\nexports.mergeClone = function (to, fromObj) {\n  if (isMongooseObject(fromObj)) {\n    fromObj = fromObj.toObject({\n      transform: false,\n      virtuals: false,\n      depopulate: true,\n      getters: false,\n      flattenDecimals: false\n    });\n  }\n\n  const keys = Object.keys(fromObj);\n  const len = keys.length;\n  let i = 0;\n  let key;\n\n  while (i < len) {\n    key = keys[i++];\n\n    if (specialProperties.has(key)) {\n      continue;\n    }\n\n    if (typeof to[key] === 'undefined') {\n      to[key] = exports.clone(fromObj[key], {\n        transform: false,\n        virtuals: false,\n        depopulate: true,\n        getters: false,\n        flattenDecimals: false\n      });\n    } else {\n      let val = fromObj[key];\n\n      if (val != null && val.valueOf && !(val instanceof Date)) {\n        val = val.valueOf();\n      }\n\n      if (exports.isObject(val)) {\n        let obj = val;\n\n        if (isMongooseObject(val) && !val.isMongooseBuffer) {\n          obj = obj.toObject({\n            transform: false,\n            virtuals: false,\n            depopulate: true,\n            getters: false,\n            flattenDecimals: false\n          });\n        }\n\n        if (val.isMongooseBuffer) {\n          obj = Buffer.from(obj);\n        }\n\n        exports.mergeClone(to[key], obj);\n      } else {\n        to[key] = exports.clone(val, {\n          flattenDecimals: false\n        });\n      }\n    }\n  }\n};\n/**\n * Executes a function on each element of an array (like _.each)\n *\n * @param {Array} arr\n * @param {Function} fn\n * @api private\n */\n\n\nexports.each = function (arr, fn) {\n  for (let i = 0; i < arr.length; ++i) {\n    fn(arr[i]);\n  }\n};\n/*!\n * ignore\n */\n\n\nexports.getOption = function (name) {\n  const sources = Array.prototype.slice.call(arguments, 1);\n\n  for (const source of sources) {\n    if (source[name] != null) {\n      return source[name];\n    }\n  }\n\n  return null;\n};\n/*!\n * ignore\n */\n\n\nexports.noop = function () {};","map":{"version":3,"sources":["D:/Other/Git/Developer-Connector/node_modules/mongoose/lib/utils.js"],"names":["Decimal","require","ObjectId","PopulateOptions","PromiseProvider","cloneRegExp","get","sliced","mpath","ms","symbols","Buffer","emittedSymbol","Symbol","for","MongooseBuffer","MongooseArray","Document","specialProperties","Set","exports","toCollectionName","name","pluralize","deepEqual","a","b","Date","getTime","isBsonType","toString","RegExp","source","ignoreCase","multiline","global","undefined","prototype","Number","valueOf","isBuffer","buffer","areEqual","isMongooseObject","toObject","ka","kb","key","i","Object","keys","e","length","sort","obj","typename","last","arr","clone","options","isArrayChild","Array","isArray","cloneArray","_skipSingleNestedGetters","$isSingleNested","assign","getters","json","toJSON","constructor","getFunctionName","cloneObject","id","flattenDecimals","fromString","isObject","schemaTypeSymbol","bson","toBSON","promiseOrCallback","callback","fn","ee","error","listeners","emit","process","nextTick","apply","arguments","Promise","resolve","reject","res","slice","call","omit","ret","minimize","hasKeys","k","has","val","l","push","defaults","random","Math","substr","merge","to","from","path","len","omitNested","instanceOfSchema","add","overwrite","isPOJO","arg","proto","getPrototypeOf","isNativeObject","Boolean","String","isEmptyObject","hasKey","props","prop","args","tick","err","isMongooseType","v","$__","isMongooseArray","isMongooseBuffer","$isMongooseMap","expires","object","when","round","expireAfterSeconds","populate","select","model","match","subPopulate","justOne","count","singles","makeSingles","map","o","TypeError","_populateObj","forEach","test","paths","split","p","copy","getValue","setValue","_copying","set","vals","shallowCopy","hop","hasOwnProperty","isNullOrUndefined","array","flatten","filter","item","_hasOwnProperty","hasUserDefinedProperty","MAX_ARRAY_INDEX","pow","isArrayIndex","unique","primitives","ids","trim","decorate","destination","mergeClone","fromObj","transform","virtuals","depopulate","each","getOption","sources","noop"],"mappings":"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","sourcesContent":["'use strict';\n\n/*!\n * Module dependencies.\n */\n\nconst Decimal = require('./types/decimal128');\nconst ObjectId = require('./types/objectid');\nconst PopulateOptions = require('./options/PopulateOptions');\nconst PromiseProvider = require('./promise_provider');\nconst cloneRegExp = require('regexp-clone');\nconst get = require('./helpers/get');\nconst sliced = require('sliced');\nconst mpath = require('mpath');\nconst ms = require('ms');\nconst symbols = require('./helpers/symbols');\nconst Buffer = require('safe-buffer').Buffer;\n\nconst emittedSymbol = Symbol.for('mongoose:emitted');\n\nlet MongooseBuffer;\nlet MongooseArray;\nlet Document;\n\nconst specialProperties = new Set(['__proto__', 'constructor', 'prototype']);\n\nexports.specialProperties = specialProperties;\n\n/*!\n * Produces a collection name from model `name`. By default, just returns\n * the model name\n *\n * @param {String} name a model name\n * @param {Function} pluralize function that pluralizes the collection name\n * @return {String} a collection name\n * @api private\n */\n\nexports.toCollectionName = function(name, pluralize) {\n  if (name === 'system.profile') {\n    return name;\n  }\n  if (name === 'system.indexes') {\n    return name;\n  }\n  if (typeof pluralize === 'function') {\n    return pluralize(name);\n  }\n  return name;\n};\n\n/*!\n * Determines if `a` and `b` are deep equal.\n *\n * Modified from node/lib/assert.js\n *\n * @param {any} a a value to compare to `b`\n * @param {any} b a value to compare to `a`\n * @return {Boolean}\n * @api private\n */\n\nexports.deepEqual = function deepEqual(a, b) {\n  if (a === b) {\n    return true;\n  }\n\n  if (a instanceof Date && b instanceof Date) {\n    return a.getTime() === b.getTime();\n  }\n\n  if ((isBsonType(a, 'ObjectID') && isBsonType(b, 'ObjectID')) ||\n      (isBsonType(a, 'Decimal128') && isBsonType(b, 'Decimal128'))) {\n    return a.toString() === b.toString();\n  }\n\n  if (a instanceof RegExp && b instanceof RegExp) {\n    return a.source === b.source &&\n        a.ignoreCase === b.ignoreCase &&\n        a.multiline === b.multiline &&\n        a.global === b.global;\n  }\n\n  if (typeof a !== 'object' && typeof b !== 'object') {\n    return a == b;\n  }\n\n  if (a === null || b === null || a === undefined || b === undefined) {\n    return false;\n  }\n\n  if (a.prototype !== b.prototype) {\n    return false;\n  }\n\n  // Handle MongooseNumbers\n  if (a instanceof Number && b instanceof Number) {\n    return a.valueOf() === b.valueOf();\n  }\n\n  if (Buffer.isBuffer(a)) {\n    return exports.buffer.areEqual(a, b);\n  }\n\n  if (isMongooseObject(a)) {\n    a = a.toObject();\n  }\n  if (isMongooseObject(b)) {\n    b = b.toObject();\n  }\n\n  let ka;\n  let kb;\n  let key;\n  let i;\n  try {\n    ka = Object.keys(a);\n    kb = Object.keys(b);\n  } catch (e) {\n    // happens when one is a string literal and the other isn't\n    return false;\n  }\n\n  // having the same number of owned properties (keys incorporates\n  // hasOwnProperty)\n  if (ka.length !== kb.length) {\n    return false;\n  }\n\n  // the same set of keys (although not necessarily the same order),\n  ka.sort();\n  kb.sort();\n\n  // ~~~cheap key test\n  for (i = ka.length - 1; i >= 0; i--) {\n    if (ka[i] !== kb[i]) {\n      return false;\n    }\n  }\n\n  // equivalent values for every corresponding key, and\n  // ~~~possibly expensive deep test\n  for (i = ka.length - 1; i >= 0; i--) {\n    key = ka[i];\n    if (!deepEqual(a[key], b[key])) {\n      return false;\n    }\n  }\n\n  return true;\n};\n\n/*!\n * Get the bson type, if it exists\n */\n\nfunction isBsonType(obj, typename) {\n  return get(obj, '_bsontype', void 0) === typename;\n}\n\n/*!\n * Get the last element of an array\n */\n\nexports.last = function(arr) {\n  if (arr.length > 0) {\n    return arr[arr.length - 1];\n  }\n  return void 0;\n};\n\n/*!\n * Object clone with Mongoose natives support.\n *\n * If options.minimize is true, creates a minimal data object. Empty objects and undefined values will not be cloned. This makes the data payload sent to MongoDB as small as possible.\n *\n * Functions are never cloned.\n *\n * @param {Object} obj the object to clone\n * @param {Object} options\n * @param {Boolean} isArrayChild true if cloning immediately underneath an array. Special case for minimize.\n * @return {Object} the cloned object\n * @api private\n */\n\nexports.clone = function clone(obj, options, isArrayChild) {\n  if (obj == null) {\n    return obj;\n  }\n\n  if (Array.isArray(obj)) {\n    return cloneArray(obj, options);\n  }\n\n  if (isMongooseObject(obj)) {\n    // Single nested subdocs should apply getters later in `applyGetters()`\n    // when calling `toObject()`. See gh-7442, gh-8295\n    if (options && options._skipSingleNestedGetters && obj.$isSingleNested) {\n      options = Object.assign({}, options, { getters: false });\n    }\n    if (options && options.json && typeof obj.toJSON === 'function') {\n      return obj.toJSON(options);\n    }\n    return obj.toObject(options);\n  }\n\n  if (obj.constructor) {\n    switch (exports.getFunctionName(obj.constructor)) {\n      case 'Object':\n        return cloneObject(obj, options, isArrayChild);\n      case 'Date':\n        return new obj.constructor(+obj);\n      case 'RegExp':\n        return cloneRegExp(obj);\n      default:\n        // ignore\n        break;\n    }\n  }\n\n  if (obj instanceof ObjectId) {\n    return new ObjectId(obj.id);\n  }\n  if (isBsonType(obj, 'Decimal128')) {\n    if (options && options.flattenDecimals) {\n      return obj.toJSON();\n    }\n    return Decimal.fromString(obj.toString());\n  }\n\n  if (!obj.constructor && exports.isObject(obj)) {\n    // object created with Object.create(null)\n    return cloneObject(obj, options, isArrayChild);\n  }\n\n  if (obj[symbols.schemaTypeSymbol]) {\n    return obj.clone();\n  }\n\n  // If we're cloning this object to go into a MongoDB command,\n  // and there's a `toBSON()` function, assume this object will be\n  // stored as a primitive in MongoDB and doesn't need to be cloned.\n  if (options && options.bson && typeof obj.toBSON === 'function') {\n    return obj;\n  }\n\n  if (obj.valueOf != null) {\n    return obj.valueOf();\n  }\n\n  return cloneObject(obj, options, isArrayChild);\n};\nconst clone = exports.clone;\n\n/*!\n * ignore\n */\n\nexports.promiseOrCallback = function promiseOrCallback(callback, fn, ee) {\n  if (typeof callback === 'function') {\n    return fn(function(error) {\n      if (error != null) {\n        if (ee != null && ee.listeners('error').length > 0 && !error[emittedSymbol]) {\n          error[emittedSymbol] = true;\n          ee.emit('error', error);\n        }\n        try {\n          callback(error);\n        } catch (error) {\n          return process.nextTick(() => {\n            throw error;\n          });\n        }\n        return;\n      }\n      callback.apply(this, arguments);\n    });\n  }\n\n  const Promise = PromiseProvider.get();\n\n  return new Promise((resolve, reject) => {\n    fn(function(error, res) {\n      if (error != null) {\n        if (ee != null && ee.listeners('error').length > 0 && !error[emittedSymbol]) {\n          error[emittedSymbol] = true;\n          ee.emit('error', error);\n        }\n        return reject(error);\n      }\n      if (arguments.length > 2) {\n        return resolve(Array.prototype.slice.call(arguments, 1));\n      }\n      resolve(res);\n    });\n  });\n};\n\n/*!\n * ignore\n */\n\nexports.omit = function omit(obj, keys) {\n  if (keys == null) {\n    return Object.assign({}, obj);\n  }\n  if (!Array.isArray(keys)) {\n    keys = [keys];\n  }\n\n  const ret = Object.assign({}, obj);\n  for (const key of keys) {\n    delete ret[key];\n  }\n  return ret;\n};\n\n/*!\n * ignore\n */\n\nfunction cloneObject(obj, options, isArrayChild) {\n  const minimize = options && options.minimize;\n  const ret = {};\n  let hasKeys;\n\n  for (const k in obj) {\n    if (specialProperties.has(k)) {\n      continue;\n    }\n\n    // Don't pass `isArrayChild` down\n    const val = clone(obj[k], options);\n\n    if (!minimize || (typeof val !== 'undefined')) {\n      hasKeys || (hasKeys = true);\n      ret[k] = val;\n    }\n  }\n\n  return minimize && !isArrayChild ? hasKeys && ret : ret;\n}\n\nfunction cloneArray(arr, options) {\n  const ret = [];\n  for (let i = 0, l = arr.length; i < l; i++) {\n    ret.push(clone(arr[i], options, true));\n  }\n  return ret;\n}\n\n/*!\n * Shallow copies defaults into options.\n *\n * @param {Object} defaults\n * @param {Object} options\n * @return {Object} the merged object\n * @api private\n */\n\nexports.options = function(defaults, options) {\n  const keys = Object.keys(defaults);\n  let i = keys.length;\n  let k;\n\n  options = options || {};\n\n  while (i--) {\n    k = keys[i];\n    if (!(k in options)) {\n      options[k] = defaults[k];\n    }\n  }\n\n  return options;\n};\n\n/*!\n * Generates a random string\n *\n * @api private\n */\n\nexports.random = function() {\n  return Math.random().toString().substr(3);\n};\n\n/*!\n * Merges `from` into `to` without overwriting existing properties.\n *\n * @param {Object} to\n * @param {Object} from\n * @api private\n */\n\nexports.merge = function merge(to, from, options, path) {\n  options = options || {};\n\n  const keys = Object.keys(from);\n  let i = 0;\n  const len = keys.length;\n  let key;\n\n  path = path || '';\n  const omitNested = options.omitNested || {};\n\n  while (i < len) {\n    key = keys[i++];\n    if (options.omit && options.omit[key]) {\n      continue;\n    }\n    if (omitNested[path]) {\n      continue;\n    }\n    if (specialProperties.has(key)) {\n      continue;\n    }\n    if (to[key] == null) {\n      to[key] = from[key];\n    } else if (exports.isObject(from[key])) {\n      if (!exports.isObject(to[key])) {\n        to[key] = {};\n      }\n      if (from[key] != null) {\n        if (from[key].instanceOfSchema) {\n          if (to[key].instanceOfSchema) {\n            to[key].add(from[key].clone());\n          } else {\n            to[key] = from[key].clone();\n          }\n          continue;\n        } else if (from[key] instanceof ObjectId) {\n          to[key] = new ObjectId(from[key]);\n          continue;\n        }\n      }\n      merge(to[key], from[key], options, path ? path + '.' + key : key);\n    } else if (options.overwrite) {\n      to[key] = from[key];\n    }\n  }\n};\n\n/*!\n * Applies toObject recursively.\n *\n * @param {Document|Array|Object} obj\n * @return {Object}\n * @api private\n */\n\nexports.toObject = function toObject(obj) {\n  Document || (Document = require('./document'));\n  let ret;\n\n  if (obj == null) {\n    return obj;\n  }\n\n  if (obj instanceof Document) {\n    return obj.toObject();\n  }\n\n  if (Array.isArray(obj)) {\n    ret = [];\n\n    for (let i = 0, len = obj.length; i < len; ++i) {\n      ret.push(toObject(obj[i]));\n    }\n\n    return ret;\n  }\n\n  if (exports.isPOJO(obj)) {\n    ret = {};\n\n    for (const k in obj) {\n      if (specialProperties.has(k)) {\n        continue;\n      }\n      ret[k] = toObject(obj[k]);\n    }\n\n    return ret;\n  }\n\n  return obj;\n};\n\n/*!\n * Determines if `arg` is an object.\n *\n * @param {Object|Array|String|Function|RegExp|any} arg\n * @api private\n * @return {Boolean}\n */\n\nexports.isObject = function(arg) {\n  if (Buffer.isBuffer(arg)) {\n    return true;\n  }\n  return Object.prototype.toString.call(arg) === '[object Object]';\n};\n\n/*!\n * Determines if `arg` is a plain old JavaScript object (POJO). Specifically,\n * `arg` must be an object but not an instance of any special class, like String,\n * ObjectId, etc.\n *\n * `Object.getPrototypeOf()` is part of ES5: https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/getPrototypeOf\n *\n * @param {Object|Array|String|Function|RegExp|any} arg\n * @api private\n * @return {Boolean}\n */\n\nexports.isPOJO = function isPOJO(arg) {\n  if (arg == null || typeof arg !== 'object') {\n    return false;\n  }\n  const proto = Object.getPrototypeOf(arg);\n  // Prototype may be null if you used `Object.create(null)`\n  // Checking `proto`'s constructor is safe because `getPrototypeOf()`\n  // explicitly crosses the boundary from object data to object metadata\n  return !proto || proto.constructor.name === 'Object';\n};\n\n/*!\n * Determines if `obj` is a built-in object like an array, date, boolean,\n * etc.\n */\n\nexports.isNativeObject = function(arg) {\n  return Array.isArray(arg) ||\n    arg instanceof Date ||\n    arg instanceof Boolean ||\n    arg instanceof Number ||\n    arg instanceof String;\n};\n\n/*!\n * Determines if `val` is an object that has no own keys\n */\n\nexports.isEmptyObject = function(val) {\n  return val != null &&\n    typeof val === 'object' &&\n    Object.keys(val).length === 0;\n};\n\n/*!\n * Search if `obj` or any POJOs nested underneath `obj` has a property named\n * `key`\n */\n\nexports.hasKey = function hasKey(obj, key) {\n  const props = Object.keys(obj);\n  for (const prop of props) {\n    if (prop === key) {\n      return true;\n    }\n    if (exports.isPOJO(obj[prop]) && exports.hasKey(obj[prop], key)) {\n      return true;\n    }\n  }\n  return false;\n};\n\n/*!\n * A faster Array.prototype.slice.call(arguments) alternative\n * @api private\n */\n\nexports.args = sliced;\n\n/*!\n * process.nextTick helper.\n *\n * Wraps `callback` in a try/catch + nextTick.\n *\n * node-mongodb-native has a habit of state corruption when an error is immediately thrown from within a collection callback.\n *\n * @param {Function} callback\n * @api private\n */\n\nexports.tick = function tick(callback) {\n  if (typeof callback !== 'function') {\n    return;\n  }\n  return function() {\n    try {\n      callback.apply(this, arguments);\n    } catch (err) {\n      // only nextTick on err to get out of\n      // the event loop and avoid state corruption.\n      process.nextTick(function() {\n        throw err;\n      });\n    }\n  };\n};\n\n/*!\n * Returns true if `v` is an object that can be serialized as a primitive in\n * MongoDB\n */\n\nexports.isMongooseType = function(v) {\n  return v instanceof ObjectId || v instanceof Decimal || v instanceof Buffer;\n};\n\n/*!\n * Returns if `v` is a mongoose object that has a `toObject()` method we can use.\n *\n * This is for compatibility with libs like Date.js which do foolish things to Natives.\n *\n * @param {any} v\n * @api private\n */\n\nexports.isMongooseObject = function(v) {\n  Document || (Document = require('./document'));\n  MongooseArray || (MongooseArray = require('./types').Array);\n  MongooseBuffer || (MongooseBuffer = require('./types').Buffer);\n\n  if (v == null) {\n    return false;\n  }\n\n  return v.$__ != null || // Document\n    v.isMongooseArray || // Array or Document Array\n    v.isMongooseBuffer || // Buffer\n    v.$isMongooseMap; // Map\n};\n\nconst isMongooseObject = exports.isMongooseObject;\n\n/*!\n * Converts `expires` options of index objects to `expiresAfterSeconds` options for MongoDB.\n *\n * @param {Object} object\n * @api private\n */\n\nexports.expires = function expires(object) {\n  if (!(object && object.constructor.name === 'Object')) {\n    return;\n  }\n  if (!('expires' in object)) {\n    return;\n  }\n\n  let when;\n  if (typeof object.expires !== 'string') {\n    when = object.expires;\n  } else {\n    when = Math.round(ms(object.expires) / 1000);\n  }\n  object.expireAfterSeconds = when;\n  delete object.expires;\n};\n\n/*!\n * populate helper\n */\n\nexports.populate = function populate(path, select, model, match, options, subPopulate, justOne, count) {\n  // might have passed an object specifying all arguments\n  let obj = null;\n  if (arguments.length === 1) {\n    if (path instanceof PopulateOptions) {\n      return [path];\n    }\n\n    if (Array.isArray(path)) {\n      const singles = makeSingles(path);\n      return singles.map(o => exports.populate(o)[0]);\n    }\n\n    if (exports.isObject(path)) {\n      obj = Object.assign({}, path);\n    } else {\n      obj = { path: path };\n    }\n  } else if (typeof model === 'object') {\n    obj = {\n      path: path,\n      select: select,\n      match: model,\n      options: match\n    };\n  } else {\n    obj = {\n      path: path,\n      select: select,\n      model: model,\n      match: match,\n      options: options,\n      populate: subPopulate,\n      justOne: justOne,\n      count: count\n    };\n  }\n\n  if (typeof obj.path !== 'string') {\n    throw new TypeError('utils.populate: invalid path. Expected string. Got typeof `' + typeof path + '`');\n  }\n\n  return _populateObj(obj);\n\n  // The order of select/conditions args is opposite Model.find but\n  // necessary to keep backward compatibility (select could be\n  // an array, string, or object literal).\n  function makeSingles(arr) {\n    const ret = [];\n    arr.forEach(function(obj) {\n      if (/[\\s]/.test(obj.path)) {\n        const paths = obj.path.split(' ');\n        paths.forEach(function(p) {\n          const copy = Object.assign({}, obj);\n          copy.path = p;\n          ret.push(copy);\n        });\n      } else {\n        ret.push(obj);\n      }\n    });\n\n    return ret;\n  }\n};\n\nfunction _populateObj(obj) {\n  if (Array.isArray(obj.populate)) {\n    const ret = [];\n    obj.populate.forEach(function(obj) {\n      if (/[\\s]/.test(obj.path)) {\n        const copy = Object.assign({}, obj);\n        const paths = copy.path.split(' ');\n        paths.forEach(function(p) {\n          copy.path = p;\n          ret.push(exports.populate(copy)[0]);\n        });\n      } else {\n        ret.push(exports.populate(obj)[0]);\n      }\n    });\n    obj.populate = exports.populate(ret);\n  } else if (obj.populate != null && typeof obj.populate === 'object') {\n    obj.populate = exports.populate(obj.populate);\n  }\n\n  const ret = [];\n  const paths = obj.path.split(' ');\n  if (obj.options != null) {\n    obj.options = exports.clone(obj.options);\n  }\n\n  for (let i = 0; i < paths.length; ++i) {\n    ret.push(new PopulateOptions(Object.assign({}, obj, { path: paths[i] })));\n  }\n\n  return ret;\n}\n\n/*!\n * Return the value of `obj` at the given `path`.\n *\n * @param {String} path\n * @param {Object} obj\n */\n\nexports.getValue = function(path, obj, map) {\n  return mpath.get(path, obj, '_doc', map);\n};\n\n/*!\n * Sets the value of `obj` at the given `path`.\n *\n * @param {String} path\n * @param {Anything} val\n * @param {Object} obj\n */\n\nexports.setValue = function(path, val, obj, map, _copying) {\n  mpath.set(path, val, obj, '_doc', map, _copying);\n};\n\n/*!\n * Returns an array of values from object `o`.\n *\n * @param {Object} o\n * @return {Array}\n * @private\n */\n\nexports.object = {};\nexports.object.vals = function vals(o) {\n  const keys = Object.keys(o);\n  let i = keys.length;\n  const ret = [];\n\n  while (i--) {\n    ret.push(o[keys[i]]);\n  }\n\n  return ret;\n};\n\n/*!\n * @see exports.options\n */\n\nexports.object.shallowCopy = exports.options;\n\n/*!\n * Safer helper for hasOwnProperty checks\n *\n * @param {Object} obj\n * @param {String} prop\n */\n\nconst hop = Object.prototype.hasOwnProperty;\nexports.object.hasOwnProperty = function(obj, prop) {\n  return hop.call(obj, prop);\n};\n\n/*!\n * Determine if `val` is null or undefined\n *\n * @return {Boolean}\n */\n\nexports.isNullOrUndefined = function(val) {\n  return val === null || val === undefined;\n};\n\n/*!\n * ignore\n */\n\nexports.array = {};\n\n/*!\n * Flattens an array.\n *\n * [ 1, [ 2, 3, [4] ]] -> [1,2,3,4]\n *\n * @param {Array} arr\n * @param {Function} [filter] If passed, will be invoked with each item in the array. If `filter` returns a falsy value, the item will not be included in the results.\n * @return {Array}\n * @private\n */\n\nexports.array.flatten = function flatten(arr, filter, ret) {\n  ret || (ret = []);\n\n  arr.forEach(function(item) {\n    if (Array.isArray(item)) {\n      flatten(item, filter, ret);\n    } else {\n      if (!filter || filter(item)) {\n        ret.push(item);\n      }\n    }\n  });\n\n  return ret;\n};\n\n/*!\n * ignore\n */\n\nconst _hasOwnProperty = Object.prototype.hasOwnProperty;\n\nexports.hasUserDefinedProperty = function(obj, key) {\n  if (obj == null) {\n    return false;\n  }\n\n  if (Array.isArray(key)) {\n    for (const k of key) {\n      if (exports.hasUserDefinedProperty(obj, k)) {\n        return true;\n      }\n    }\n    return false;\n  }\n\n  if (_hasOwnProperty.call(obj, key)) {\n    return true;\n  }\n  if (key in obj) {\n    const v = obj[key];\n    return v !== Object.prototype[key] && v !== Array.prototype[key];\n  }\n\n  return false;\n};\n\n/*!\n * ignore\n */\n\nconst MAX_ARRAY_INDEX = Math.pow(2, 32) - 1;\n\nexports.isArrayIndex = function(val) {\n  if (typeof val === 'number') {\n    return val >= 0 && val <= MAX_ARRAY_INDEX;\n  }\n  if (typeof val === 'string') {\n    if (!/^\\d+$/.test(val)) {\n      return false;\n    }\n    val = +val;\n    return val >= 0 && val <= MAX_ARRAY_INDEX;\n  }\n\n  return false;\n};\n\n/*!\n * Removes duplicate values from an array\n *\n * [1, 2, 3, 3, 5] => [1, 2, 3, 5]\n * [ ObjectId(\"550988ba0c19d57f697dc45e\"), ObjectId(\"550988ba0c19d57f697dc45e\") ]\n *    => [ObjectId(\"550988ba0c19d57f697dc45e\")]\n *\n * @param {Array} arr\n * @return {Array}\n * @private\n */\n\nexports.array.unique = function(arr) {\n  const primitives = {};\n  const ids = {};\n  const ret = [];\n  const length = arr.length;\n  for (let i = 0; i < length; ++i) {\n    if (typeof arr[i] === 'number' || typeof arr[i] === 'string' || arr[i] == null) {\n      if (primitives[arr[i]]) {\n        continue;\n      }\n      ret.push(arr[i]);\n      primitives[arr[i]] = true;\n    } else if (arr[i] instanceof ObjectId) {\n      if (ids[arr[i].toString()]) {\n        continue;\n      }\n      ret.push(arr[i]);\n      ids[arr[i].toString()] = true;\n    } else {\n      ret.push(arr[i]);\n    }\n  }\n\n  return ret;\n};\n\n/*!\n * Determines if two buffers are equal.\n *\n * @param {Buffer} a\n * @param {Object} b\n */\n\nexports.buffer = {};\nexports.buffer.areEqual = function(a, b) {\n  if (!Buffer.isBuffer(a)) {\n    return false;\n  }\n  if (!Buffer.isBuffer(b)) {\n    return false;\n  }\n  if (a.length !== b.length) {\n    return false;\n  }\n  for (let i = 0, len = a.length; i < len; ++i) {\n    if (a[i] !== b[i]) {\n      return false;\n    }\n  }\n  return true;\n};\n\nexports.getFunctionName = function(fn) {\n  if (fn.name) {\n    return fn.name;\n  }\n  return (fn.toString().trim().match(/^function\\s*([^\\s(]+)/) || [])[1];\n};\n\n/*!\n * Decorate buffers\n */\n\nexports.decorate = function(destination, source) {\n  for (const key in source) {\n    if (specialProperties.has(key)) {\n      continue;\n    }\n    destination[key] = source[key];\n  }\n};\n\n/**\n * merges to with a copy of from\n *\n * @param {Object} to\n * @param {Object} fromObj\n * @api private\n */\n\nexports.mergeClone = function(to, fromObj) {\n  if (isMongooseObject(fromObj)) {\n    fromObj = fromObj.toObject({\n      transform: false,\n      virtuals: false,\n      depopulate: true,\n      getters: false,\n      flattenDecimals: false\n    });\n  }\n  const keys = Object.keys(fromObj);\n  const len = keys.length;\n  let i = 0;\n  let key;\n\n  while (i < len) {\n    key = keys[i++];\n    if (specialProperties.has(key)) {\n      continue;\n    }\n    if (typeof to[key] === 'undefined') {\n      to[key] = exports.clone(fromObj[key], {\n        transform: false,\n        virtuals: false,\n        depopulate: true,\n        getters: false,\n        flattenDecimals: false\n      });\n    } else {\n      let val = fromObj[key];\n      if (val != null && val.valueOf && !(val instanceof Date)) {\n        val = val.valueOf();\n      }\n      if (exports.isObject(val)) {\n        let obj = val;\n        if (isMongooseObject(val) && !val.isMongooseBuffer) {\n          obj = obj.toObject({\n            transform: false,\n            virtuals: false,\n            depopulate: true,\n            getters: false,\n            flattenDecimals: false\n          });\n        }\n        if (val.isMongooseBuffer) {\n          obj = Buffer.from(obj);\n        }\n        exports.mergeClone(to[key], obj);\n      } else {\n        to[key] = exports.clone(val, {\n          flattenDecimals: false\n        });\n      }\n    }\n  }\n};\n\n/**\n * Executes a function on each element of an array (like _.each)\n *\n * @param {Array} arr\n * @param {Function} fn\n * @api private\n */\n\nexports.each = function(arr, fn) {\n  for (let i = 0; i < arr.length; ++i) {\n    fn(arr[i]);\n  }\n};\n\n/*!\n * ignore\n */\n\nexports.getOption = function(name) {\n  const sources = Array.prototype.slice.call(arguments, 1);\n\n  for (const source of sources) {\n    if (source[name] != null) {\n      return source[name];\n    }\n  }\n\n  return null;\n};\n\n/*!\n * ignore\n */\n\nexports.noop = function() {};\n"]},"metadata":{},"sourceType":"script"}